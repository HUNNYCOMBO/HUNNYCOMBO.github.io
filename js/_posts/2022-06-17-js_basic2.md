---
title: 코딩엘리 자바스크립트 입문편 2 - 비동기 프로그래밍
excerpt: 비동기 프로그램이에 대하여 공부합니다.
tags: [js, async, callback, promise]
---

## 1. 동기와 비동기
js는 동기적인 언어입니다. hoisting(var, function 선언이 최상단으로 올라가는 것)이 된 이후 부터 코드가 나타나는 순서대로 실행이 됩니다. callback 함수에 대해 다시 알아봅니다.  
callback함수는 우리가 전달해준 함수를 원할때 다시 실행시켜 달라는 의미입니다. browserAPI인 setTimeout의 정의를 살펴보면 handeler라는 callback함수를 파라미터로 받는 것을 볼 수 있습니다.  

```javascirpt
console.log('1');
setTimeout(function () {
  console.log('2');
  }, 1000);
console.log('3');
```

![image](https://user-images.githubusercontent.com/78904413/174243064-752bfb8b-e66c-48d4-9131-a48cf30dbf94.png)
절차대로 1을 찍고 2에서는 browserAPI를 만났으므로 browser에서 1초의 시간이 지난 후 2를 출력하라는 신호를 보내게 되어 콘솔이 아래와 같이 찍히게 됩니다. 이것이 async 입니다.  


![image](https://user-images.githubusercontent.com/78904413/174548581-493ebf05-4dbe-40b2-a2be-c7a5099fa08e.png)

### 1.1. 콜백 정리
콜백은 비동기적 상황에서만 사용하는 것은 아닙니다. 비동기와 동기 콜백으로 나뉘어 집니다. 위의 자바스크립트와 합쳐서 생각해봅니다.  
```javascript
// 동기적인 콜백
function printImmeditaely(print) {  // 함수는 hositng됩니다.
  print();
}
printImmediately(()=>console.log('hello'));
```

![image](https://user-images.githubusercontent.com/78904413/174549193-6a29b405-2891-43bf-83f6-40093c3331e3.png)

이제 비동기적 콜백을 알아봅니다.  
```javascript
function printWithDelay(print, timeout){
  setTimeout(print, timeout);
}
printWithDelay(()=>console.log('async callback'), 2000);
```

![image](https://user-images.githubusercontent.com/78904413/174549446-6fdced98-a91c-44c7-bc8a-558d78ae1e97.png)

### 1.2.  콜백 지옥
콜백은 유용하지만 너무 남발하게되면 콜백지옥에 빠지기 쉽습니다. 콜백지옥을 체험하는 코드를 작성해봅니다.  

```javascript
// 콜백지옥 로그인 성공시 성공했다는 onSuccess 콜백함수, 에러시 onError 콜백 함수, 로그인 성공시 역할을 불러오는 함수실행
class UserStorage {
  loginUser(id, password, onSuccess, onError) {
    setTimeout(()=>{
      if(로그인 로직 생략){
        onSuccess(id)
      }else{
        onError(new Error('not found')); 
      }      
    }, 2000);
  }
  
  getRoles(user, onSuccess, onError) {
    setTimeout(()=>{
      if(user === 'lala') {
        onSuccess({ name: 'lala', role: 'admin'});
      }else{
        onError(new Error('no access'));
      }
    },1000);
  }
}

const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = prompt('enter your password');
userStorage.loginUser(
  id,
  password,
  user => {
    userStorage.getRoles(
      user,
      (userWithRole) => {
      
    })
  }
)
```

![image](https://user-images.githubusercontent.com/78904413/174552302-575a388b-49f5-455d-a50f-6411eb327ae4.png)



---
layout: single
title:  "DBMS가 제공하는 트랜잭션"
categories: spring
tags: [database, dbms, transaction]
toc: true
toc_sticky : true
author_profile: false
sidebar:
nav: "docs"
search: true
---

## 참고링크
+[네이버 D2](https://d2.naver.com/helloworld/407507)

## 1.트랜잭션이란?
**하나의 논리적 작업 단위**를 구성하는 연산들의 집합을 트랜잭션이라고 합니다.  
대표적인 예로,  
1. 한 계좌에서 10만원을 인출
2. 다른 계좌로 10만원을 이체

이런 일련의 작업은 전체 작업이 정상적으로 완료되거나, 정상적으로 처리되지 않는경우 아무것도 실행되지 않은 처음 상태로 되돌려져야 합니다.

## 2. ACID
흔히 트랜잭션은 ACID 성질이라고 하는 네 가지 정의로 설명됩니다.
### 2.1. Atociticy(원자성)
DBMS는 완료되지 않은 트랜잭션(작업 단위)의 중간 상태를 DB에 번영해서는 안됩니다.  
쉽게 '**all or nothing**'특성으로 설명됩니다.  
### 2.2. Consistency(일관성)
고립된 트랜잭션 수행이 DB의 일관성을 보존해야 합니다.  
**성공적**으로 수행된 트랜잭션은 **정당한** 데이터들만을 DB에 반영해야 한다는 말입니다.  
트랜잭션 수행으로 보존해야 할 일관성은 PK, FK 제약 같은 명시적인 무결성 제약조건 뿐만 아니라, 자금 이체 예에서 두 계좌의 잔고 합이 이체 전후 둘다 같아야 한다는  
비명시적인 일관성 조건들도 있습니다.  
### 2.3. Isolation(독립성)
여러 트랜잭션이 동시에 수행되더라도 각각의 트랜잭션은 다른 트랜잭션에 영향을 받지않고 독립적으로 수행되어야 합니다.  
이러한 isolation성질이 보장되지 않으면 트랜잭션이 원래 상태로 되돌아 갈 수 없게 됩니다.  
DBMS는 병렬적으로 트랜잭션을 수행하면서도 일렬수행과 같은 결과를 보장할 수 있는 방식을 제공합니다.  
### 2.4. Durability(지속성)
트랜잭션이 성공적으로 커밋되고 나면, 해당 트랜잭션에 의한 모든 변경은 어떤 장애가 발생되더라도 보존되어야 합니다.

## 3. 트랜잭션 관리를 위한 DBMS의 전략
데이터베이스 시스템은 보통 디스크에 데이터를 저장하며, 전체 데이터베이스의 **일부분**을 메인 메모리에 유지합니다.  
DBMS는 데이터를 고정 길이의 page로 저장하며, 디스크에서 page단위로 입출력이 이루어집니다.  
메인 메모리에 유지하는 page들을 page buffer(버퍼 관리자)라고 부르는대, DBMS에서 매우 중요한 모듈 중 하나입니다.  

버퍼 관리 정책이 트래잭션 관리에 매우 중요한 결정을 가져옵니다. 버퍼 관리 정책에 따라서 UNDO복구와 REDO복구가 요구되거나 그렇지 않게 됩니다.  

### 3.1. UNDO
오퍼레이션(명령어) 수행 중에 수정된 page들이 page buffer에 의해 디스크에 쓰여질 수 있습니다. 이는 임의의 방식으로 일어나게 됩니다.  
즉, 아직 완료되지 않은 트랜잭션이 수정한 page들도 디스크에 출력될 수 있으므로, 만약 트랜잭션이 정상적으로 종료될 수 없게되면 트랜잭션이 변경한 page(데이터)들은 원상 복구되어야 합니다.  
page buffer가 트랜잭션 종료 전에 절대로 수정된 page들을 디스크에 쓰지 않는다면(출력하지 않는다면), UNDO는 메모리 버퍼에 대해서만 이루어지면 되는식으로 간단해 질 수 있습니다.  
이는 매력적이지만 매우 큰 크기의 메모리 버퍼가 필요하다는 문제가 있습니다.  

수정된 page를 디스크에 쓰는 시점을 기준으로 두개의 정책으로 나눌 수 있습니다.  
- STEAL : 수정된 page를 언제든지 디스크에 쓸 수 있는 정책. 필연적으로 UNDO로깅과 복구를 수반합니다. 거의 모든 DMBS가 채택하는 버퍼 관리 정책입니다.
- -STEAL : 수정된 page들을 최소한 트랜잭션 종료 시점(EOT)까지는 버퍼에 유지하는 정책.

### 3.2. REDO
